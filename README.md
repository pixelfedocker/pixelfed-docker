# pixelfed-docker
pixelfed docker instance
# Part 1: Introduction & Core Setup

```markdown
# Pixelfed Self-Hosting Guide

## TL;DR
This repository contains comprehensive documentation for self-hosting Pixelfed, an open-source photo sharing platform. Currently in ALPHA (v-10.0.1z_01), this guide walks through setup, configuration, and maintenance of a Pixelfed instance, focusing on security and best practices.

### IMPORTANT DISCLOSURE
This documentation was generated by AI and is maintained by community contributors. It is NOT officially affiliated with Pixelfed, Docker, or any other mentioned organizations. This is an unofficial guide created to help beginners, and while we (the AI & contriubutors) strive for accuracy, you should always refer to official documentation for critical deployments.

### Security Notice
Running any public-facing service carries inherent risks. Always:
- Keep security in mind when configuring your instance
- Maintain regular backups
- Keep your system and applications updated
- Follow security best practices for your operating system
- Consider the privacy implications of hosting user data

## Quick Navigation
- [Prerequisites](#prerequisites)
- [Initial Setup](#initial-setup)
- [Docker Installation](#docker-installation)
- [Network Configuration](#network-configuration)
- [SSL/HTTPS Setup](#ssl-setup)
- [Pixelfed Installation](#pixelfed-installation)
- [Maintenance](#maintenance)
- [Backup & Recovery](#backup-and-recovery)
- [Data Stewardship](#data-stewardship)
- [Troubleshooting](#troubleshooting)
- [Additional Resources](#additional-resources)

## What You'll Need
- A computer or server running Linux (Ubuntu 24.04 LTS or newer recommended)
- Minimum 2GB RAM (4GB recommended)
- 20GB storage (more depending on media storage needs)
- A domain name (Use a random scam-azon brand name for discounts)
- Root or sudo access
- About 30 minutes of time
- Basic terminal familiarity

## First Time Using Linux?
If you're new to Linux, here are some basics:
1. Commands are typed into a "terminal"
2. Open terminal in Ubuntu: `Ctrl + Alt + T`
3. Lines starting with `#` are comments (explanations)
4. Lines starting with `$` are commands to type
5. Copy text: `Ctrl + C`
6. Paste into terminal: `Ctrl + Shift + V`

## Prerequisites
### Required Packages
```bash
# Update your system
sudo apt update && sudo apt upgrade -y

# Install required tools
sudo apt install -y \
    curl \
    git \
    nginx \
    ufw \
    certbot \
    python3-certbot-nginx
```

## Initial Setup
### System Preparation
1. Update hostname:
```bash
sudo hostnamectl set-hostname pixelfed.yourdomain.com
```

2. Configure timezone:
```bash
sudo timedatectl set-timezone UTC
```

3. Configure firewall:
```bash
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

## Docker Installation
### Install Docker Engine
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# IMPORTANT: Log out and log back in now!
```

### Install Docker Compose
```bash
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Verify installations
docker --version
docker-compose --version
```
```
# Part 2: Network Configuration & SSL Setup

```markdown
## Network Configuration
### DNS Setup
1. Create A record pointing to your server's IP
2. Configure reverse DNS (PTR record)
3. Add SPF and DMARC records if email is enabled

### Nginx Configuration
```nginx
server {
    listen 80;
    listen [::]:80;
    server_name pixelfed.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## SSL Setup
### Development Certificates
**IMPORTANT SECURITY NOTICE**
This section describes creating self-signed certificates for **DEVELOPMENT AND TESTING ONLY**.
For production environments, always use proper certificates from trusted authorities.

### Production SSL with Let's Encrypt

#### Method 1: Certbot with Nginx
```bash
# Install Certbot
sudo apt update
sudo apt install certbot python3-certbot-nginx

# Obtain certificate
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# Test auto-renewal
sudo certbot renew --dry-run

# Set up automatic renewal
sudo systemctl status certbot.timer
```

#### Method 2: Manual Installation
```bash
# Install Certbot
sudo apt install certbot

# Stop nginx
sudo systemctl stop nginx

# Obtain certificate
sudo certbot certonly --standalone -d yourdomain.com -d www.yourdomain.com
```

### Production Nginx SSL Configuration
```nginx
server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;

    # Strong SSL Security
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;

    # HSTS (uncomment if you're sure)
    # add_header Strict-Transport-Security "max-age=63072000" always;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    return 301 https://$server_name$request_uri;
}
```

### SSL Maintenance Tasks
- Monitor certificate expiration
- Set up monitoring for SSL/TLS issues
- Keep software updated
- Regular security audits
- Maintain proper backup of certificates

### Certificate Management Best Practices
1. Never share private keys
2. Maintain secure backups of certificates
3. Document renewal procedures
4. Monitor certificate validity
5. Keep contact information updated with CA

### SSL Troubleshooting
```bash
# Test SSL configuration
sudo nginx -t

# Check certificate validity
sudo certbot certificates

# View certificate details
openssl x509 -in /etc/letsencrypt/live/yourdomain.com/cert.pem -text -noout

# Test SSL connection
openssl s_client -connect yourdomain.com:443 -tls1_2
```

## Pixelfed Installation
### Docker Compose Setup
Create `docker-compose.yml`:
```yaml
version: '3'
services:
  app:
    image: pixelfed/pixelfed:latest
    restart: always
    environment:
      - APP_ENV=production
      - APP_KEY=${APP_KEY}
      - DB_HOST=db
      - DB_DATABASE=pixelfed
      - DB_USERNAME=pixelfed
      - DB_PASSWORD=${DB_PASSWORD}
    volumes:
      - ./storage:/var/www/storage
    depends_on:
      - db
      - redis

  db:
    image: mysql:8.0
    restart: always
    environment:
      - MYSQL_DATABASE=pixelfed
      - MYSQL_USER=pixelfed
      - MYSQL_PASSWORD=${DB_PASSWORD}
      - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD}
    volumes:
      - ./mysql:/var/lib/mysql

  redis:
    image: redis:alpine
    restart: always
```

### Environment Configuration
Create `.env` file:
```bash
APP_NAME=Pixelfed
APP_ENV=production
APP_KEY=
APP_DEBUG=false
APP_URL=https://pixelfed.yourdomain.com

DB_CONNECTION=mysql
DB_HOST=db
DB_PORT=3306
DB_DATABASE=pixelfed
DB_USERNAME=pixelfed
DB_PASSWORD=your_secure_password
```
```

# Part 3: Maintenance, Backup & Recovery, and Data Stewardship

```markdown
## Maintenance Operations

### Basic Commands
```bash
# Start all services
docker-compose up -d

# Stop all services
docker-compose down

# View logs
docker-compose logs -f

# View logs for specific service
docker-compose logs -f app|db|redis

# Restart specific service
docker-compose restart app|db|redis

# Check service status
docker-compose ps
```

### Update Procedures
```bash
# Pull latest changes
git pull

# Pull latest Docker images
docker-compose pull

# Rebuild and restart services
docker-compose down
docker-compose up -d --build

# Clear cache
docker-compose exec app php artisan cache:clear
```

## Backup & Recovery

### Automated Backup Script
```bash
#!/bin/bash
# backup.sh

BACKUP_DIR="/path/to/backups"
DATE=$(date +%Y%m%d_%H%M%S)

# Create backup directory
mkdir -p "$BACKUP_DIR/$DATE"

# Stop services
docker-compose down

# Backup database
docker-compose exec db mysqldump -u root -p"${DB_ROOT_PASSWORD}" pixelfed > "$BACKUP_DIR/$DATE/database.sql"

# Backup uploads and config
tar -czf "$BACKUP_DIR/$DATE/storage.tar.gz" ./storage
tar -czf "$BACKUP_DIR/$DATE/env.tar.gz" .env

# Restart services
docker-compose up -d

# Cleanup old backups (keep last 7 days)
find "$BACKUP_DIR" -type d -mtime +7 -exec rm -rf {} \;
```

### Backup Best Practices (3-2-1 Rule)
1. Three copies of data
2. Two different storage types
3. One off-site backup

```bash
# Example of remote backup using rclone
rclone copy /path/to/backups remote:pixelfed-backups

# Verify backup integrity
sha256sum "$BACKUP_DIR/$DATE/database.sql" > "$BACKUP_DIR/$DATE/checksums.txt"
sha256sum "$BACKUP_DIR/$DATE/storage.tar.gz" >> "$BACKUP_DIR/$DATE/checksums.txt"
```

### Recovery Procedures
```bash
# Restore database
docker-compose down
cat backup/database.sql | docker-compose exec -T db mysql -u root -p"${DB_ROOT_PASSWORD}" pixelfed

# Restore files
tar -xzf backup/storage.tar.gz
tar -xzf backup/env.tar.gz

# Rebuild and restart
docker-compose up -d --build
docker-compose exec app php artisan cache:clear
```

## Data Stewardship

### Instance Management Documentation
```plaintext
# Instance Documentation Template

Instance Details:
----------------
Name: [Instance Name]
URL: [Instance URL]
Admin Email: [Admin Email]
Launch Date: [Date]

Infrastructure:
--------------
Server Provider: [Provider Name]
Server Location: [Location]
Server Specs: [CPU/RAM/Storage]
Hosting Cost: [Monthly Cost]

Access Details:
--------------
SSH Access: ssh user@hostname -p port
Admin Panel: https://instance/admin
Database: [Connection Details]
Monitoring: [Monitoring URL]

Emergency Contacts:
-----------------
Primary Admin: [Name/Contact]
Backup Admin: [Name/Contact]
Technical Support: [Contact]

Maintenance Schedule:
-------------------
Backups: [Schedule]
Updates: [Schedule]
Security Audits: [Schedule]
```

### User Data Protection
1. Privacy Policy Requirements
```plaintext
Our instance commits to:
- Transparent data handling
- Minimal data collection
- Secure storage practices
- Regular backups
- Clear deletion procedures
- User data portability
```

2. Data Retention Policy
```plaintext
We retain:
- User content: Until deletion request
- Logs: 30 days
- Backups: 90 days
- Analytics: Anonymized after 12 months
```

### Monitoring & Alerts

1. System Monitoring
```bash
# Install monitoring stack
docker-compose -f monitoring-stack.yml up -d

# Basic system monitoring
docker stats

# Check disk usage
df -h

# Monitor logs
tail -f /var/log/nginx/error.log
```

2. Alert Configuration
```yaml
# Example alert rules
alerts:
  - disk_usage_threshold: 80%
  - memory_usage_threshold: 90%
  - cpu_usage_threshold: 95%
  - certificate_expiry: 14d
```

### Emergency Response Plan
```plaintext
1. Incident Detection:
   - Monitor system alerts
   - User reports
   - Security scans

2. Initial Response:
   - Assess severity
   - Document incident
   - Notify team

3. Containment:
   - Isolate affected systems
   - Block suspicious traffic
   - Enable maintenance mode

4. Investigation:
   - Review logs
   - Identify cause
   - Document findings

5. Recovery:
   - Restore from backup
   - Patch vulnerabilities
   - Test systems

6. Communication:
   - Notify users
   - Update status page
   - Document lessons learned
```

## Additional Resources

### Self Managed Life
- FUTO wiki: https://wiki.futo.org/index.php/Introduction_to_a_Self_Managed_Life:_a_13_hour_%26_28_minute_presentation_by_FUTO_software
- FUTO Video: https://inv.nadeko.net/watch?v=3fW9TV1WQi8
    -YT video: https://youtu.be/Et5PPMYuOc8
- 
### Community Support
- Discord: [Pixelfed Discord](https://discord.gg/pixelfed)
- Forum: [community.pixelfed.org](https://community.pixelfed.org)
- Matrix: [#pixelfed:matrix.org](https://matrix.to/#/#pixelfed:matrix.org)

### Documentation & Learning
- [Official Pixelfed Documentation](https://docs.pixelfed.org/)
- [Docker Documentation](https://docs.docker.com/)
- [Nginx Documentation](https://nginx.org/en/docs/)
- [Let's Encrypt Documentation](https://letsencrypt.org/docs/)

### Security Resources
- [OWASP Security Cheat Sheet](https://cheatsheetseries.owasp.org/)
- [Mozilla Security Guidelines](https://infosec.mozilla.org/)
- [Digital Ocean Security Tutorials](https://www.digitalocean.com/community/tutorials?q=security)
```


Pixelfed Email Server Setup Guide
Part 1: Understanding Email for Pixelfed

### Why Add Email to Pixelfed?
Your Pixelfed instance needs email for:
- User account management (password resets, verification)
- System alerts (storage warnings, errors)
- Admin notifications (reports, new users)
- Community management (user reports, content flags)

### What We'll Set Up
1. Email server (using docker-mailserver)
2. Integration with Pixelfed
3. Monitoring and alerts
4. Basic maintenance tools
Part 2: Email Server Setup

# Add this to your existing docker-compose.yml
version: '3'
services:
  # Your existing Pixelfed services remain unchanged
  
  mailserver:
    image: docker.io/mailserver/docker-mailserver:latest
    hostname: mail.yourdomain.com
    ports:
      - "587:587"  # For sending mail (most important)
    volumes:
      - ./mailserver/data:/var/mail
      - ./mailserver/state:/var/mail-state
      - ./mailserver/logs:/var/log/mail
      - ./mailserver/config:/tmp/docker-mailserver
    environment:
      - ENABLE_SPAMASSASSIN=1
      - ENABLE_CLAMAV=1
      - ENABLE_FAIL2BAN=1
      - SSL_TYPE=letsencrypt
    networks:
      - pixelfed_network
    depends_on:
      - pixelfed
Part 3: Configure Pixelfed for Email

# Update your .env file with these settings
MAIL_DRIVER=smtp
MAIL_HOST=mailserver    # This matches the service name in docker-compose
MAIL_PORT=587
MAIL_USERNAME=system@yourdomain.com
MAIL_PASSWORD=your-secure-password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=system@yourdomain.com
MAIL_FROM_NAME="Your Pixelfed Instance"
Part 4: Create System Emails

#!/bin/bash
# setup-emails.sh

# Create email setup directory
mkdir -p mailserver/config

# Create system email account
docker run --rm \
  -e MAIL_USER=system@yourdomain.com \
  -e MAIL_PASS=your-secure-password \
  -v "$PWD/mailserver/config":/tmp/docker-mailserver \
  docker.io/mailserver/docker-mailserver:latest \
  /bin/sh -c 'echo "$MAIL_USER|$(doveadm pw -s SHA512-CRYPT -u $MAIL_USER -p $MAIL_PASS)"' >> mailserver/config/postfix-accounts.cf
Part 5: DNS Configuration

Add these records to your domain (where you got your domain):

1. MX Record:
   Type: MX
   Host: @
   Points to: mail.yourdomain.com
   Priority: 10

2. SPF Record:
   Type: TXT
   Host: @
   Value: "v=spf1 mx a:mail.yourdomain.com -all"
Part 6: Testing

# Create test script
cat > test-email.sh << 'EOF'
#!/bin/bash

echo "Testing Pixelfed email setup..."

# Test system email
docker exec -i pixelfed_app_1 php artisan test:mail

# Check mail logs
docker exec mailserver tail /var/log/mail.log

echo "Check your email and mail.log for results"
EOF

chmod +x test-email.sh
./test-email.sh
Part 7: Common Issues

### If Emails Aren't Working:

1. Check Connections:
   ```bash
   # Verify mailserver is running
   docker-compose ps mailserver
   
   # Check logs
   docker-compose logs mailserver
Common Problems:

Wrong mailserver hostname
Incorrect DNS records
Ports blocked by firewall
Solutions:

Wait 24-48h for DNS changes
Check server firewall (ports 25, 587)
Verify passwords in .env match setup

## Part 8: Maintenance
```bash
# Create maintenance script
cat > email-maintenance.sh << 'EOF'
#!/bin/bash

# Update email server
docker-compose pull mailserver
docker-compose up -d mailserver

# Check logs
docker-compose logs --tail=100 mailserver

# Clear mail queue if needed
docker exec mailserver postqueue -f

echo "Email server maintenance complete"
EOF

chmod +x email-maintenance.sh
